version: 2

builds:
- id: watchman
  main: ./cmd/server
  binary: watchman
  env:
    - CGO_ENABLED=1
    - RELEASE=yes
  goos:
    - linux
    - darwin
    - windows
  goarch:
    - amd64
    - arm64
  ignore:
    - goos: windows
      goarch: arm64
    - goos: darwin
      goarch: 386
  ldflags:
    - -s -w # strip debug info + DWARF
    - -X main.Version={{ .Version }}
    - -X main.Commit={{ .FullCommit }}
    - -X main.Date={{ .Date }}
    - -X github.com/moov-io/watchman.Version={{ .Tag }}
- id: watchman-ui
  main: ./cmd/ui
  binary: watchman-ui
  env:
    - CGO_ENABLED=1
    - RELEASE=yes
  goos:
    - linux
    - darwin
    - windows
  goarch:
    - amd64
    - arm64
  ignore:
    - goos: windows
      goarch: arm64
    - goos: darwin
      goarch: 386
  ldflags:
    - -s -w # strip debug info + DWARF
    - -X main.Version={{ .Version }}
    - -X main.Commit={{ .FullCommit }}
    - -X main.Date={{ .Date }}
    - -X github.com/moov-io/watchman.Version={{ .Tag }}
